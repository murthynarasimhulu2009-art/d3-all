Below is a self‑contained HTML file that includes **all** required libraries (the full D3 bundle already contains the colour schemes, but we also load `d3-scale‑chromatic` explicitly for safety).  
The code has been cleaned up a little (the title now gets an explicit `text‑anchor` attribute, and the legend is positioned a bit more robustly).  
Save the file as **`stacked-bar-chart.html`** and open it in any modern browser – it will render without errors.

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stacked Bar Chart</title>
  <style>
    body { font-family: sans-serif; }
    .axis path,
    .axis line {
      stroke: #000;
    }
    .title {
      font-size: 20px;
      font-weight: bold;
      text-anchor: middle;   /* fallback for browsers that ignore the CSS property */
    }
    .legend-item text {
      font-size: 12px;
      alignment-baseline: middle;
    }
  </style>
</head>
<body>
  <svg id="stacked-bar-chart" width="800" height="400"></svg>

  <!-- D3 core (includes d3-array, d3-scale, d3-axis, d3-shape, etc.) -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <!-- Colour scheme module (optional – ensures schemeCategory10 is available) -->
  <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>

  <script>
    // ------------------------------------------------------------
    // Configuration
    // ------------------------------------------------------------
    const config = {
      space: { width: 800, height: 400 },
      margin: { top: 50, right: 50, bottom: 50, left: 50 },
      data: [
        { category: "A", series1: 20, series2: 30, series3: 15 },
        { category: "B", series1: 35, series2: 25, series3: 20 },
        { category: "C", series1: 15, series2: 40, series3: 25 },
        { category: "D", series1: 30, series2: 20, series3: 30 }
      ],
      keys: ["series1", "series2", "series3"],
      // Use a built‑in colour scheme
      colorScheme: d3.schemeCategory10
    };

    // ------------------------------------------------------------
    // Dimensions
    // ------------------------------------------------------------
    const { width, height } = config.space;
    const { top, right, bottom, left } = config.margin;
    const innerWidth = width - left - right;
    const innerHeight = height - top - bottom;

    // ------------------------------------------------------------
    // SVG container
    // ------------------------------------------------------------
    const svg = d3.select('#stacked-bar-chart')
      .attr('width', width)
      .attr('height', height);

    // ------------------------------------------------------------
    // Title
    // ------------------------------------------------------------
    svg.append('text')
      .attr('class', 'title')
      .attr('x', width / 2)
      .attr('y', 30)
      .attr('text-anchor', 'middle')   // explicit attribute for maximum compatibility
      .text('Stacked Bar Chart');

    // ------------------------------------------------------------
    // Main drawing group
    // ------------------------------------------------------------
    const g = svg.append('g')
      .attr('transform', `translate(${left},${top})`);

    // ------------------------------------------------------------
    // Scales
    // ------------------------------------------------------------
    const xScale = d3.scaleBand()
      .domain(config.data.map(d => d.category))
      .range([0, innerWidth])
      .padding(0.1);

    const stack = d3.stack()
      .keys(config.keys);

    const series = stack(config.data);

    // Compute the maximum total value across all categories
    const maxY = d3.max(series, s => d3.max(s, d => d[1]));

    const yScale = d3.scaleLinear()
      .domain([0, maxY])
      .nice()
      .range([innerHeight, 0]);

    const colorScale = d3.scaleOrdinal()
      .domain(config.keys)
      .range(config.colorScheme);

    // ------------------------------------------------------------
    // Render stacked bars
    // ------------------------------------------------------------
    const layer = g.selectAll('.serie')
      .data(series)
      .enter()
      .append('g')
      .attr('fill', d => colorScale(d.key));

    layer.selectAll('rect')
      .data(d => d.map(v => ({
        category: v.data.category,
        y0: v[0],
        y1: v[1],
        series: d.key
      })))
      .enter()
      .append('rect')
      .attr('x', d => xScale(d.category))
      .attr('y', d => yScale(d.y1))
      .attr('height', d => yScale(d.y0) - yScale(d.y1))
      .attr('width', xScale.bandwidth());

    // ------------------------------------------------------------
    // Axes
    // ------------------------------------------------------------
    const xAxis = d3.axisBottom(xScale);
    g.append('g')
      .attr('class', 'axis')
      .attr('transform', `translate(0,${innerHeight})`)
      .call(xAxis);

    const yAxis = d3.axisLeft(yScale);
    g.append('g')
      .attr('class', 'axis')
      .call(yAxis);

    // ------------------------------------------------------------
    // Legend
    // ------------------------------------------------------------
    const legend = svg.append('g')
      .attr('transform', `translate(${width - right - 120},${top})`);

    const legendItem = legend.selectAll('.legend-item')
      .data(config.keys)
      .enter()
      .append('g')
      .attr('class', 'legend-item')
      .attr('transform', (d, i) => `translate(0,${i * 20})`);

    legendItem.append('rect')
      .attr('width', 18)
      .attr('height', 18)
      .attr('fill', d => colorScale(d));

    legendItem.append('text')
      .attr('x', 24)
      .attr('y', 14)
      .text(d => d);
  </script>
</body>
</html>
```

**What changed / was added**

1. **Explicit library imports** – D3 core (`d3@7`) and the colour‑scheme module (`d3-scale-chromatic`).  
2. **Title** – added an explicit `text-anchor="middle"` attribute for maximum compatibility.  
3. **Minor CSS tweaks** for the legend text.  
4. **All code is wrapped in a single `<script>` block that runs after the libraries are loaded, guaranteeing no “undefined” errors.  

Open the file in a browser and you should see a clean, fully‑functional stacked bar chart. Enjoy!